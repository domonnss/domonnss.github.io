<!doctype html>
<html lang="zh"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta><title>bazel - l4rk&#039;s blog</title><link rel="manifest" href="/manifest.json"><meta name="application-name" content="l4rk"><meta name="msapplication-TileImage" content="/img/favicon.svg"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="l4rk"><meta name="apple-mobile-web-app-status-bar-style" content="default"><meta name="description" content="转载自什么是Bazel—教程、实例和优势作者：方石剑链接：https:&amp;#x2F;&amp;#x2F;juejin.cn&amp;#x2F;post&amp;#x2F;7120840097863303199来源：稀土掘金著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 Bazel是一个开源的构建工具，由谷歌开发，用于自动化大规模软件的构建过程。Pinterest、Adobe、SpaceX、Nvidia和LinkedIn等公司都使用它。在本教"><meta property="og:type" content="blog"><meta property="og:title" content="l4rk"><meta property="og:url" content="https://l4rk.cn/"><meta property="og:site_name" content="l4rk"><meta property="og:description" content="转载自什么是Bazel—教程、实例和优势作者：方石剑链接：https:&amp;#x2F;&amp;#x2F;juejin.cn&amp;#x2F;post&amp;#x2F;7120840097863303199来源：稀土掘金著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 Bazel是一个开源的构建工具，由谷歌开发，用于自动化大规模软件的构建过程。Pinterest、Adobe、SpaceX、Nvidia和LinkedIn等公司都使用它。在本教"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="https://imgr.whimsical.com/object/7QC4f6WFb4aNNGq2gX8yEx"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Functional_Builds_in_Bazel_2hH8Y8tHiS.png?updatedAt=1633183549939"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Deploying_Bazel_Build_with_Docker_and_Kubernetes_Mth2agFmYaF.png?updatedAt=1633183549078"><meta property="og:image" content="https://wpblog.semaphoreci.com/wp-content/uploads/2021/10/image-1056x382.png"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Terminologies_in_a_build_workflow_2x_NRxCJw2f_Md.png?updatedAt=1633242922284"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Build_Process_2x_BYDtPQkdR.png?updatedAt=1633191206254"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Init_Result_EWKFlpXoLFo.PNG?updatedAt=1633233883720"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Project_Directory_nOHtI-4-_CG.PNG?updatedAt=1633233559923"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Terminal_Output_zQI4TUnyXGd.PNG?updatedAt=1633234152481"><meta property="og:image" content="https://ik.imagekit.io/pibjyepn7p9/Bazel_Output_files_and_folders_vEsXkRLbUcU6.PNG?updatedAt=1633233559113"><meta property="article:published_time" content="2024-02-28T12:52:23.771Z"><meta property="article:modified_time" content="2024-03-08T09:02:50.383Z"><meta property="article:author" content="l4rk"><meta property="article:tag" content="bazel"><meta property="article:tag" content="编译"><meta property="twitter:card" content="summary"><meta property="twitter:image" content="https://imgr.whimsical.com/object/7QC4f6WFb4aNNGq2gX8yEx"><script type="application/ld+json">{"@context":"https://schema.org","@type":"BlogPosting","mainEntityOfPage":{"@type":"WebPage","@id":"http://l4rk.cn/2024/02/52f793c64d0c.html"},"headline":"bazel","image":["https://wpblog.semaphoreci.com/wp-content/uploads/2021/10/image-1056x382.png"],"datePublished":"2024-02-28T12:52:23.771Z","dateModified":"2024-03-08T09:02:50.383Z","author":{"@type":"Person","name":"l4rk"},"publisher":{"@type":"Organization","name":"l4rk's blog","logo":{"@type":"ImageObject","url":"http://l4rk.cn/img/logo.svg"}},"description":"转载自什么是Bazel—教程、实例和优势作者：方石剑链接：https:&#x2F;&#x2F;juejin.cn&#x2F;post&#x2F;7120840097863303199来源：稀土掘金著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。 Bazel是一个开源的构建工具，由谷歌开发，用于自动化大规模软件的构建过程。Pinterest、Adobe、SpaceX、Nvidia和LinkedIn等公司都使用它。在本教"}</script><link rel="canonical" href="http://l4rk.cn/2024/02/52f793c64d0c.html"><link rel="alternate" href="/atom.xml" title="l4rk&#039;s blog" type="application/atom+xml"><link rel="icon" href="/img/favicon.svg"><link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.2/css/all.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@9.12.0/styles/atom-one-light.css"><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Ubuntu:wght@400;600&amp;family=Source+Code+Pro"><link rel="stylesheet" href="/css/default.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css"><!--!--><style>body>.footer,body>.navbar,body>.section{opacity:0}</style><!--!--><!--!--><!--!--><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js" defer></script><!--!--><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/css/lightgallery.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/css/justifiedGallery.min.css"><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/pace-js@1.0.2/pace.min.js"></script><!--!--><!--!--><meta name="generator" content="Hexo 5.4.2"></head><body class="is-3-column"><nav class="navbar navbar-main"><div class="container"><div class="navbar-brand justify-content-center"><a class="navbar-item navbar-logo" href="/"><img src="/img/logo.svg" alt="l4rk&#039;s blog" height="28"></a></div><div class="navbar-menu"><div class="navbar-start"><a class="navbar-item" href="/">主页</a><a class="navbar-item" href="/archives">文章归档</a><a class="navbar-item" href="/categories">分类</a><a class="navbar-item" href="/tags">标签</a><a class="navbar-item" href="/about">关于</a></div><div class="navbar-end"><a class="navbar-item" target="_blank" rel="noopener" title="Github" href="https://github.com/domonnss"><i class="fab fa-github"></i></a><a class="navbar-item is-hidden-tablet catalogue" title="目录" href="javascript:;"><i class="fas fa-list-ul"></i></a><a class="navbar-item search" title="搜索" href="javascript:;"><i class="fas fa-search"></i></a></div></div></div></nav><section class="section"><div class="container"><div class="columns"><div class="column order-2 column-main is-8-tablet is-8-desktop is-8-widescreen"><div class="card"><article class="card-content article" role="article"><div class="article-meta is-size-7 is-uppercase level is-mobile"><div class="level-left"><span class="level-item"><time dateTime="2024-02-28T12:52:23.771Z" title="2024/2/28 20:52:23">2024-02-28</time>发表</span><span class="level-item"><time dateTime="2024-03-08T09:02:50.383Z" title="2024/3/8 17:02:50">2024-03-08</time>更新</span><span class="level-item"><a class="link-muted" href="/categories/tech/">tech</a></span><span class="level-item">33 分钟读完 (大约4905个字)</span><span class="level-item" id="busuanzi_container_page_pv"><span id="busuanzi_value_page_pv">0</span>次访问</span></div></div><h1 class="title is-3 is-size-4-mobile">bazel</h1><div class="content"><p>转载自<br><a target="_blank" rel="noopener" href="https://juejin.cn/post/7120840097863303199">什么是Bazel—教程、实例和优势</a><br>作者：方石剑<br>链接：<a target="_blank" rel="noopener" href="https://juejin.cn/post/7120840097863303199">https://juejin.cn/post/7120840097863303199</a><br>来源：稀土掘金<br>著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。</p>
<p><a href="https://link.juejin.cn?target=https%3A%2F%2Fbazel.build%2F" title="https://bazel.build/">Bazel</a>是一个开源的构建工具，由谷歌开发，用于自动化大规模软件的构建过程。Pinterest、Adobe、SpaceX、Nvidia和LinkedIn等<a href="https://link.juejin.cn?target=https%3A%2F%2Fbazel.build%2Fusers.html" title="https://bazel.build/users.html">公司</a>都使用它。在本教程中，你将了解什么是Bazel，它如何工作，以及它的重要好处。你还会学到如何为你的monorepo项目生成Bazel构建。</p>
<h2 id="你为什么要使用Bazel？"><a href="#你为什么要使用Bazel？" class="headerlink" title="你为什么要使用Bazel？"></a><strong>你为什么要使用Bazel？</strong></h2><p>Bazel的工作原理与<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.gnu.org%2Fsoftware%2Fmake%2F" title="https://www.gnu.org/software/make/">Make</a>、<a href="https://link.juejin.cn?target=https%3A%2F%2Fmaven.apache.org%2F" title="https://maven.apache.org/">Maven</a>或<a href="https://link.juejin.cn?target=https%3A%2F%2Fgradle.org%2F" title="https://gradle.org/">Gradle</a>等其他构建工具类似。然而，与其他工具不同的是，Bazel是为具有多语言依赖性的项目量身定做的。</p>
<p>例如，你可以有一个Rust或Go的服务器，一个flutter的移动客户端，和一个Angular的网络客户端。在这种情况下，如果你要手动编写自己的构建文件，以迎合每种语言的生态系统，这可能是一项艰巨的任务。幸运的是，Bazel为你完成了所有繁重的工作：</p>
<p><img src="https://imgr.whimsical.com/object/7QC4f6WFb4aNNGq2gX8yEx" alt="bazel tutorial, bazel build"></p>
<p>Bazel最吸引人的特点之一是你可以轻松地将它与你的项目的<a href="https://link.juejin.cn?target=https%3A%2F%2Fsemaphoreci.com%2Fcicd" title="https://semaphoreci.com/cicd">CI/CD</a>挂钩。这可以帮助你提高团队的生产力，因为你可以产生更可靠的构建，定期和严格地测试你的软件。因此，你也可以很容易地出货和发布更强大的构建。</p>
<p>然而，Bazel不仅仅是处理多语言的依赖关系。让我们来探讨一些使它如此强大的好处。</p>
<h2 id="Bazel有哪些优点？"><a href="#Bazel有哪些优点？" class="headerlink" title="Bazel有哪些优点？"></a><strong>Bazel有哪些优点？</strong></h2><p>以下是使Bazel成为出色的构建工具的关键优势。</p>
<p><strong>可重复性</strong>：Bazel产生纯功能构建，你的输出文件严格依赖于你的输入。这给你的构建带来两个重要的特点。首先，你的构建是<em>密封的</em>，这意味着只有你明确提到的输入可以被你的构建步骤所读取。第二，你的构建是<em>可</em>重复的，或者换句话说，是可复制的。如果你使用一组固定的输入，Bazel每次都会产生相同的构建。可重复的构建使调试你的构建操作更加方便。</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Functional_Builds_in_Bazel_2hH8Y8tHiS.png?updatedAt=1633183549939" alt="Functional Builds in Bazel"></p>
<p><strong>与Docker和Kubernetes集成</strong>：归功于其多功能性，Bazel补充了现代平台和系统，如Docker和Kubernetes。例如，你可以为你的monorepo准备一个方便的Docker容器，其中包含一个web客户端和一堆微服务。然后你可以用它来启动一个类似于生产环境的测试环境。这样你就可以通过你的容器来测试你的Bazel构建。此外，你可以启用增量构建，并使用AWS Fargate或Kubernetes等协调引擎管理你的部署。</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Deploying_Bazel_Build_with_Docker_and_Kubernetes_Mth2agFmYaF.png?updatedAt=1633183549078" alt="Deploying Bazel Build using Docker and Kubernetes"></p>
<p><strong>可扩展性</strong>：Bazel的发明源于谷歌的一个内部构建工具Blaze。在谷歌内部，Bazel处理包含超过<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoq.com%2Fnews%2F2020%2F01%2Fdropbox-bazel-ci%2F" title="https://www.infoq.com/news/2020/01/dropbox-bazel-ci/">10万个</a>源文件的项目的构建。换句话说，Bazel非常适合拥有庞大代码库的大型项目。虽然它提倡单程序模式，但它也能轻松处理微服务架构。<a href="https://link.juejin.cn?target=https%3A%2F%2Fwww.infoq.com%2Fnews%2F2020%2F01%2Fdropbox-bazel-ci%2F" title="https://www.infoq.com/news/2020/01/dropbox-bazel-ci/">Dropbox使用Bazel</a>来扩展他们的<a href="https://link.juejin.cn?target=https%3A%2F%2Fsemaphoreci.com%2Fblog%2Fcicd-pipeline" title="https://semaphoreci.com/blog/cicd-pipeline">CI/CD管道</a>，以减少对他们的提交执行的测试数量。<a href="https://link.juejin.cn?target=https%3A%2F%2Feng.uber.com%2Fgo-monorepo-bazel%2F" title="https://eng.uber.com/go-monorepo-bazel/">Uber</a>也采用了Bazel来扩展他们的Go monorepo。他们利用Bazel的密封式构建来支持增量构建的生成，以支持他们的分布式基础设施。</p>
<p><strong>声明式编程</strong>：为项目编写构建配置应该尽可能简单。Bazel是使用<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bazel.build%2Fversions%2F4.2.1%2Fskylark%2Flanguage.html" title="https://docs.bazel.build/versions/4.2.1/skylark/language.html">Starlark</a>构建的，这是一种源自Python的高级语言。因此，它为开发者提供了一种更方便的方式来编写构建配置和属性，这些配置和属性都是可读的。此外，Bazel的抽象性使开发者无需处理复杂的东西，如编译器和链接器。</p>
<p><strong>平行性和缓存</strong>：大规模的构建工具必须是高性能的。Bazel使用缓存机制来加快你的构建速度。它智能地将你的后续构建与你以前的缓存构建进行比较，只构建那些开发者更新的文件。这确保了Bazel只把你的CPU资源花在构建那些需要重新构建的项目部分。Bazel还允许你以并行的方式生成并发的构建，以节省分布式代码库的时间。你可以在单台机器上，也可以在多台机器上远程生成并行构建。</p>
<p><strong>庞大且不断增长的开源社区</strong>：Bazel的第一个版本是在2019年推出的，<a href="https://link.juejin.cn?target=https%3A%2F%2Fopensource.googleblog.com%2F2019%2F10%2Fbazel-reaches-10-milestone.html" title="https://opensource.googleblog.com/2019/10/bazel-reaches-10-milestone.html">差不多有2年</a>时间。从那时起，谷歌在两年的时间里推送了<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbazelbuild%2Fbazel%2Freleases" title="https://github.com/bazelbuild/bazel/releases">100多个版本</a>，试图为开发者不断发展这个工具。Bazel的<a href="https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fbazelbuild%2Fbazel" title="https://github.com/bazelbuild/bazel">Github repo</a>有17.4k颗星，在Stack Overflow上有超过<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2Ftagged%2Fbazel" title="https://stackoverflow.com/questions/tagged/bazel">2K个</a>标记的问题和超过<a href="https://link.juejin.cn?target=https%3A%2F%2Fstackoverflow.com%2Fsearch%3Fq%3Dbazel" title="https://stackoverflow.com/search?q=bazel">6K个</a>搜索结果。这些微小但不断增长的数字表明，它在社区中获得了相当快的吸引力。</p>
<h2 id="Bazel术语和基础知识解释"><a href="#Bazel术语和基础知识解释" class="headerlink" title="Bazel术语和基础知识解释"></a><strong>Bazel术语和基础知识解释</strong></h2><p>现在，让我们来看看Bazel使用的一些重要术语：</p>
<h3 id="工作区"><a href="#工作区" class="headerlink" title="工作区"></a><strong>工作区</strong></h3><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bazel.build%2Fversions%2Fmain%2Fbuild-ref.html%23workspace" title="https://docs.bazel.build/versions/main/build-ref.html#workspace">工作区</a>通常是Bazel从你的源代码构建你的项目的构建文件的目录。它以嵌套的层次方式包含各种源文件。在工作区的最高层或根层，你的项目可能也有一个专门的<code>WORKSPACE</code> 文本文件。它包含了对你的项目所需的所有外部依赖的引用，以生成你的构建。准确地说，工作区是你的输入被提取并转换为输出以生成所需的构建文件的地方。</p>
<h3 id="软件包"><a href="#软件包" class="headerlink" title="软件包"></a><strong>软件包</strong></h3><p><a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bazel.build%2Fversions%2Fmain%2Fbuild-ref.html%23packages" title="https://docs.bazel.build/versions/main/build-ref.html#packages">包是</a>位于工作区顶级目录下的简单目录。它们包含你的构建文件，可以命名为<code>BUILD</code> 或<code>BUILD.bazel</code> ，以及其他相关文件和指定的依赖关系。一个包可以嵌套在另一个包中，因为你的源代码是以分层的方式组织的。考虑一下下面的工作目录。</p>
<p>css</p>
<p>复制代码</p>
<p>  <code>src/application/BUILD   src/application/main/render.txt   src/application/staging/BUILD</code></p>
<p>该应用程序是一个包，因为它包含自己的<code>BUILD</code> 文件。同样，<code>staging</code> 是另一个包，但由于它直接属于<code>application</code> ，所以可以被认为是一个<em>子包</em>。然而，<code>main</code> 不是一个子包，而只是你的<code>application</code> 包内的一个普通目录，因为它没有自己的<code>BUILD</code> 文件。</p>
<h3 id="目标"><a href="#目标" class="headerlink" title="目标"></a><strong>目标</strong></h3><p>你的包内的所有东西都可以被认为是<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bazel.build%2Fversions%2Fmain%2Fbuild-ref.html%23targets" title="https://docs.bazel.build/versions/main/build-ref.html#targets">目标</a>。它包括你的团队的开发人员编写并添加到你的项目中的源文件或Bazel根据你的构建配置构建的生成文件。除了文件之外，目标通常涉及到管理你的输入文件和输出文件之间关系的规则。换句话说，目标规则规定了Bazel如何构建你的构建文件，它要采取的中间步骤以及它需要执行的每个可执行操作。你的目标规则的输入文件可以是源文件或生成文件。不过，你的输出文件总是生成文件，因为它是构建工具本身的结果。你可以指定你的目标规则，以连锁你的输入和输出，进行连续的构建操作。例如，你可以使用前一个步骤的生成文件作为未来另一个步骤的输入文件。</p>
<p><img src="https://wpblog.semaphoreci.com/wp-content/uploads/2021/10/image-1056x382.png" alt=""></p>
<h3 id="标签"><a href="#标签" class="headerlink" title="标签"></a><strong>标签</strong></h3><p>一个目标的命名法被称为<a href="https://link.juejin.cn?target=https%3A%2F%2Fdocs.bazel.build%2Fversions%2Fmain%2Fbuild-ref.html%23labels" title="https://docs.bazel.build/versions/main/build-ref.html#labels">标签</a>。它只是一种识别属于一个包的不同目标的方法，并将它们与相同或不同包中的其他目标区分开来。<br>考虑一下下面这个标签：</p>
<p>java</p>
<p>复制代码</p>
<p>  <code>@repo//application:application_source</code></p>
<p>上面的标签描述了一个包内的目标<code>application_source</code> 应用。同样地，在下面的例子中，<code>main_binary</code> 描述了在包<code>application</code> 下的子包<code>main</code> 内的一个目标：</p>
<p>ruby</p>
<p>复制代码</p>
<p>  <code>@repo//application/main:main_binary</code></p>
<p>两个目标都有不同的标签，你可以期望每个标签都能唯一地识别一个目标。</p>
<h3 id="依赖关系"><a href="#依赖关系" class="headerlink" title="依赖关系"></a><strong>依赖关系</strong></h3><p>当你构建你指定的目标时，一个或多个目标在构建过程中可能依赖于另一个目标。后者是一种依赖关系。为了进一步解释，考虑两个目标<code>Target1</code> 和<code>Target2</code> 。假设<code>Target1</code> 在构建或执行时需要<code>Target2</code> 。我们可以把这种关系表达为一个<em>有向无环图</em>，表明在这个过程中<code>Target1</code> 是如何依赖于`Target12的。Bazel称其为<a href="https://link.juejin.cn?target=https%3A%2F%2Fblog.bazel.build%2F2015%2F06%2F17%2Fvisualize-your-build.html" title="https://blog.bazel.build/2015/06/17/visualize-your-build.html">依赖图</a>，用于区分实际依赖和声明依赖。</p>
<h3 id="构建文件"><a href="#构建文件" class="headerlink" title="构建文件"></a><strong>构建文件</strong></h3><p>早些时候，我们说过，在一个<code>WORKSPACE</code> ，每个包都包含自己的<code>BUILD</code> 文件。构建文件包含使Bazel为你的项目生成所需构建的程序。它是用Starlark来评估的，包含一个由Bazel执行的顺序语句列表。构建文件包含你声明的规则，执行这些规则的函数，以及以简单语法形式要求的变量。</p>
<p>我们知道Bazel会缓存以前的构建文件以加快构建过程。每当你的源文件发生变化时，Bazel就会引用<code>BUILD</code> 文件来了解底层的变化。</p>
<h3 id="命令"><a href="#命令" class="headerlink" title="命令"></a><strong>命令</strong></h3><p>Bazel提供了一系列的命令，允许你执行某些操作。你可以运行的最简单的命令是检查Bazel是否成功安装在你的系统中：</p>
<p>css</p>
<p>复制代码</p>
<p>  <code>$ bazel --version   bazel 4.0.0</code></p>
<p>其他重要的命令有：<code>bazel build</code>,<code>bazel run</code> 和<code>bazel test</code> 。build命令，顾名思义，是为指定的输入或目标建立你的输出文件：</p>
<p>yaml</p>
<p>复制代码</p>
<p>  <code>$ bazel build //foo   INFO: Analyzed target //foo:foo (14 packages loaded, 48 targets configured).   INFO: Found 1 target...   Target //foo:foo up-to-date:     bazel-bin/foo/foo   INFO: Elapsed time: 9.905s, Critical Path: 3.25s   INFO: Build completed successfully, 6 total actions</code></p>
<p>run命令运行你的输出文件，test命令相当于同时运行build和run命令：</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Terminologies_in_a_build_workflow_2x_NRxCJw2f_Md.png?updatedAt=1633242922284" alt="Bazel Terminologies in a Build Workflow"></p>
<h2 id="用Bazel构建-编译代码"><a href="#用Bazel构建-编译代码" class="headerlink" title="用Bazel构建/编译代码"></a><strong>用Bazel构建/编译代码</strong></h2><p>现在我们知道了常见的Bazel术语，让我们明白我们可以用Bazel构建或编译我们的代码，具体步骤如下。</p>
<h3 id="1-bazelrc-文件"><a href="#1-bazelrc-文件" class="headerlink" title="1..bazelrc 文件"></a>1.<code>.bazelrc</code> 文件</h3><p>我们做的第一步是在一个专门的<code>.bazelrc</code> 文件中写入我们的构建选项。这些选项决定了每次Bazel构建你的项目时要考虑的设置。下面是一个典型的<code>.bazelrc</code> 文件的样子，如果你正在构建一个JavaScript项目：</p>
<p>lua</p>
<p>复制代码</p>
<p><code>build --disk_cache=~/.cache/bazel-disk-cache build --enable_platform_specific_config build --symlink_prefix=dist/ test --test_output=errors test:debug --test_output=streamed --test_strategy=exclusive --test_timeout=9999 --nocache_test_results --define=VERBOSE_LOGS=1 run:debug --define=VERBOSE_LOGS=1 -- --node_options=--inspect-brk build:debug --compilation_mode=dbg build --nolegacy_external_runfiles build --incompatible_strict_action_env run --incompatible_strict_action_env coverage --instrument_test_targets try-import %workspace%/.bazelrc.user</code></p>
<h3 id="2-添加buildifier-依赖关系"><a href="#2-添加buildifier-依赖关系" class="headerlink" title="2.添加buildifier 依赖关系"></a>2.添加<code>buildifier</code> 依赖关系</h3><p>为了确保你所有的构建文件都以类似的方式格式化，Bazel使用了一个名为<code>buildifier</code> 的依赖项。你可以通过运行，把它安装为你项目的开发时依赖：</p>
<p>css</p>
<p>复制代码</p>
<p><code>npm install --save-dev @bazel/buildifier</code></p>
<p>它可以确保你所有的构建文件看起来都是一样的，以便在你项目的各个构建步骤中保持一致性。当Bazel使用其缓存的工件将你当前的构建与以前的构建进行比较时，这还有助于加快你的构建过程。</p>
<h3 id="3-创建目标"><a href="#3-创建目标" class="headerlink" title="3.创建目标"></a>3.创建目标</h3><p>这是你编写Bazel需要构建的所有源代码的地方。还记得Bazel如何为你指定的目标构建输出文件吗？那基本上就是与你的项目有关的应用级代码。一旦你定义并声明你的目标，Bazel就知道在构建所需的输出时要使用哪些输入。</p>
<h3 id="4-添加构建规则"><a href="#4-添加构建规则" class="headerlink" title="4.添加构建规则"></a>4.添加构建规则</h3><p>当我们完成了我们的构建选项，我们需要使用一些规则来构建我们的项目。在这一步，你可以选择自动生成的规则或定义你自己的自定义规则。谨慎的做法是利用自动生成的规则，请记住，在Bazel的官方资源库里有少量的规则。我们在构建文件中定义这些规则。</p>
<h3 id="5-构建-编译项目"><a href="#5-构建-编译项目" class="headerlink" title="5.构建/编译项目"></a>5.构建/编译项目</h3><p>在你指定了你的构建规则后，Bazel通常会接收你的构建文件作为输入并将其加载到分析器。接下来，它根据你的目标和依赖关系产生一个动作图，并在你声明的输入上借口构建动作。最后，它产生构建输出，并将其存储在缓存工件中，供后续构建使用。</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Build_Process_2x_BYDtPQkdR.png?updatedAt=1633191206254" alt="Bazel Build Process"></p>
<p>让我们在行动中扩展这个理论，逐步看到这个过程是如何让我们用Bazel构建一个JavaScript单体的。</p>
<h2 id="用Bazel建立一个monorepo项目"><a href="#用Bazel建立一个monorepo项目" class="headerlink" title="用Bazel建立一个monorepo项目"></a><strong>用Bazel建立一个monorepo项目</strong></h2><p>为了开始，我们可以使用<code>@bazel</code> ，在一个新的NodeJS项目中直接设置Bazel：</p>
<p>kotlin</p>
<p>复制代码</p>
<p><code>npm init @bazel bazel_js_monorepo</code></p>
<p>下面是上述命令运行成功后，你应该在终端上得到的结果：</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Init_Result_EWKFlpXoLFo.PNG?updatedAt=1633233883720" alt="New Bazel Project"></p>
<p>你会注意到，现在你的项目中已经有了<code>buildifier</code> ，还有其他所需的文件，如用于管理你的JavaScript依赖的<code>package.json</code> ，你的项目的<code>WORKSPACE</code> ，以及最重要的<code>BUILD.bazel</code> 文件。</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Project_Directory_nOHtI-4-_CG.PNG?updatedAt=1633233559923" alt="New Bazel Project Workspace"></p>
<p>你还需要安装<a href="https://link.juejin.cn?target=https%3A%2F%2Fbabeljs.io%2F" title="https://babeljs.io/">Babel</a>和其他相关的依赖项来<a href="https://link.juejin.cn?target=https%3A%2F%2Fscotch.io%2Ftutorials%2Fjavascript-transpilers-what-they-are-why-we-need-them" title="https://scotch.io/tutorials/javascript-transpilers-what-they-are-why-we-need-them">转译</a>你的JavaScript代码：</p>
<p>bash</p>
<p>复制代码</p>
<p><code>npm install @babel/core @babel/cli @babel/preset-env</code></p>
<p>如果你前往<code>WORKSPACE</code> 文件，你会看到它是如何阐明Bazel在构建你的项目时需要获取的依赖项的。你需要明确地告诉Bazel你将使用哪些规则来生成你的构建。为了简洁起见，我们将使用自动生成的规则。</p>
<p>进入你项目根部的<code>BUILD.bazel</code> 文件，添加以下一行：</p>
<p>perl</p>
<p>复制代码</p>
<p><code>load(&quot;@npm//@babel/cli:index.bzl&quot;, &quot;babel&quot;)</code></p>
<p>因此，你也需要为你的项目配置Babel。在您的项目根目录下创建一个新的文件，名为<code>es5.babelrc</code> 文件。回顾一下，我们之前看到的<code>.babelrc</code> 文件的目的是描述我们的构建选项，在其中添加以下代码：</p>
<p>perl</p>
<p>复制代码</p>
<p><code>&#123;     &quot;sourceMaps&quot;: &quot;inline&quot;,     &quot;presets&quot;: [       [         &quot;@babel/preset-env&quot;,         &#123;           &quot;modules&quot;: &quot;systemjs&quot;         &#125;       ]     ]   &#125;</code></p>
<p>上面的配置类似于webpack将Babel添加到你的普通JavaScript项目中。</p>
<p>在添加你的构建规则之前，你需要向Bazel提供你的输入或源文件。本质上，这些输入是Bazel视为构建你的构建的目标。让我们在根目录下创建一个名为<code>app.js</code> 的文件。我们将创建一个简单的JavaScript类，名为<code>User</code> ，里面有一个将用户名字转换为大写字母的函数：</p>
<p>kotlin</p>
<p>复制代码</p>
<p><code>class User&#123;     constructor(name)&#123;         this.name=name     &#125;     uppercaseName()&#123;         this.name=this.name.toUpperCase();         return this.name;     &#125; &#125; const user=new User(&quot;FuzzySid&quot;) user.uppercaseName();</code></p>
<p>接下来，你需要声明这个文件作为Bazel构建的输入。之前，我们已经在<code>BUILD.bazel</code> 文件中加载了构建规则。让我们用这些规则来声明我们在<code>BUILD.bazel</code> 文件中构建的输入和输出：</p>
<p>ini</p>
<p>复制代码</p>
<p><code>babel(     name = &quot;compile&quot;,     data = [         &quot;app.js&quot;,         &quot;es5.babelrc&quot;,         &quot;@npm//@babel/preset-env&quot;,     ],     outs = [&quot;app.es5.js&quot;],     args = [         &quot;app.js&quot;,         &quot;--config-file&quot;,         &quot;./$(execpath es5.babelrc)&quot;,         &quot;--out-file&quot;,         &quot;$(execpath app.es5.js)&quot;,     ], )</code></p>
<p>最后，你可以运行构建命令，让Bazel为你施展魔法：</p>
<p>arduino</p>
<p>复制代码</p>
<p><code>npm run build</code></p>
<p>你应该在终端看到以下输出：</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Terminal_Output_zQI4TUnyXGd.PNG?updatedAt=1633234152481" alt="Bazel Build Successful"></p>
<p>在你的项目中，你现在应该有一个<code>bazel-out</code> 和一个<code>dist</code> 目录：</p>
<p><img src="https://ik.imagekit.io/pibjyepn7p9/Bazel_Output_files_and_folders_vEsXkRLbUcU6.PNG?updatedAt=1633233559113" alt="Bazel Build Output directories"></p>
<p>你转换的JavaScript代码应该出现在<code>dist/bin/app.es5.js</code> 。功夫不负有心人，你已经成功地用Bazel编译了一个JavaScript单程序</p>
</div><div class="article-tags is-size-7 mb-4"><span class="mr-2">#</span><a class="link-muted mr-2" rel="tag" href="/tags/bazel/">bazel</a><a class="link-muted mr-2" rel="tag" href="/tags/%E7%BC%96%E8%AF%91/">编译</a></div><!--!--></article></div><!--!--><nav class="post-navigation mt-4 level is-mobile"><div class="level-start"><a class="article-nav-prev level level-item link-muted" href="/2024/03/9179c2e6705b.html"><i class="level-item fas fa-chevron-left"></i><span class="level-item"> </span></a></div><div class="level-end"><a class="article-nav-next level level-item link-muted" href="/2024/02/4a0e4c432013.html"><span class="level-item"> </span><i class="level-item fas fa-chevron-right"></i></a></div></nav><!--!--></div><div class="column column-left is-4-tablet is-2-desktop is-2-widescreen  order-1 is-sticky"><div class="card widget" id="toc" data-type="toc"><div class="card-content"><div class="menu"><h3 class="menu-label">目录</h3><ul class="menu-list"><li><a class="level is-mobile" href="#你为什么要使用Bazel？"><span class="level-left"><span class="level-item">1</span><span class="level-item">你为什么要使用Bazel？</span></span></a></li><li><a class="level is-mobile" href="#Bazel有哪些优点？"><span class="level-left"><span class="level-item">2</span><span class="level-item">Bazel有哪些优点？</span></span></a></li><li><a class="level is-mobile" href="#Bazel术语和基础知识解释"><span class="level-left"><span class="level-item">3</span><span class="level-item">Bazel术语和基础知识解释</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#工作区"><span class="level-left"><span class="level-item">3.1</span><span class="level-item">工作区</span></span></a></li><li><a class="level is-mobile" href="#软件包"><span class="level-left"><span class="level-item">3.2</span><span class="level-item">软件包</span></span></a></li><li><a class="level is-mobile" href="#目标"><span class="level-left"><span class="level-item">3.3</span><span class="level-item">目标</span></span></a></li><li><a class="level is-mobile" href="#标签"><span class="level-left"><span class="level-item">3.4</span><span class="level-item">标签</span></span></a></li><li><a class="level is-mobile" href="#依赖关系"><span class="level-left"><span class="level-item">3.5</span><span class="level-item">依赖关系</span></span></a></li><li><a class="level is-mobile" href="#构建文件"><span class="level-left"><span class="level-item">3.6</span><span class="level-item">构建文件</span></span></a></li><li><a class="level is-mobile" href="#命令"><span class="level-left"><span class="level-item">3.7</span><span class="level-item">命令</span></span></a></li></ul></li><li><a class="level is-mobile" href="#用Bazel构建-编译代码"><span class="level-left"><span class="level-item">4</span><span class="level-item">用Bazel构建/编译代码</span></span></a><ul class="menu-list"><li><a class="level is-mobile" href="#1-bazelrc-文件"><span class="level-left"><span class="level-item">4.1</span><span class="level-item">1..bazelrc 文件</span></span></a></li><li><a class="level is-mobile" href="#2-添加buildifier-依赖关系"><span class="level-left"><span class="level-item">4.2</span><span class="level-item">2.添加buildifier 依赖关系</span></span></a></li><li><a class="level is-mobile" href="#3-创建目标"><span class="level-left"><span class="level-item">4.3</span><span class="level-item">3.创建目标</span></span></a></li><li><a class="level is-mobile" href="#4-添加构建规则"><span class="level-left"><span class="level-item">4.4</span><span class="level-item">4.添加构建规则</span></span></a></li><li><a class="level is-mobile" href="#5-构建-编译项目"><span class="level-left"><span class="level-item">4.5</span><span class="level-item">5.构建/编译项目</span></span></a></li></ul></li><li><a class="level is-mobile" href="#用Bazel建立一个monorepo项目"><span class="level-left"><span class="level-item">5</span><span class="level-item">用Bazel建立一个monorepo项目</span></span></a></li></ul></div></div><style>#toc .menu-list > li > a.is-active + .menu-list { display: block; }#toc .menu-list > li > a + .menu-list { display: none; }</style><script src="/js/toc.js" defer></script></div><div class="column-right-shadow is-hidden-widescreen is-sticky"></div></div><div class="column column-right is-4-tablet is-2-desktop is-2-widescreen is-hidden-touch is-hidden-desktop-only order-3 is-sticky"><div class="card widget" data-type="categories"><div class="card-content"><div class="menu"><h3 class="menu-label">分类</h3><ul class="menu-list"><li><a class="level is-mobile" href="/categories/literature/"><span class="level-start"><span class="level-item">literature</span></span><span class="level-end"><span class="level-item tag">17</span></span></a><ul><li><a class="level is-mobile" href="/categories/literature/book/"><span class="level-start"><span class="level-item">book</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li><li><a class="level is-mobile" href="/categories/literature/share/"><span class="level-start"><span class="level-item">share</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/paper/"><span class="level-start"><span class="level-item">paper</span></span><span class="level-end"><span class="level-item tag">2</span></span></a><ul><li><a class="level is-mobile" href="/categories/paper/Instance-Shadow-Detection-With-a-Single-Stage-Detector/"><span class="level-start"><span class="level-item">Instance Shadow Detection With a Single-Stage Detector</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li><li><a class="level is-mobile" href="/categories/project/"><span class="level-start"><span class="level-item">project</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/tech/"><span class="level-start"><span class="level-item">tech</span></span><span class="level-end"><span class="level-item tag">35</span></span></a><ul><li><a class="level is-mobile" href="/categories/tech/games/"><span class="level-start"><span class="level-item">games</span></span><span class="level-end"><span class="level-item tag">6</span></span></a><ul><li><a class="level is-mobile" href="/categories/tech/games/101%E5%AE%9E%E9%AA%8C/"><span class="level-start"><span class="level-item">101实验</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li></ul></li></ul></li><li><a class="level is-mobile" href="/categories/templates/"><span class="level-start"><span class="level-item">templates</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/categories/tutorial/"><span class="level-start"><span class="level-item">tutorial</span></span><span class="level-end"><span class="level-item tag">7</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/"><span class="level-start"><span class="level-item">学校课程</span></span><span class="level-end"><span class="level-item tag">7</span></span></a><ul><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/%E5%88%9B%E6%96%B0%E5%AE%9E%E8%B7%B5/"><span class="level-start"><span class="level-item">创新实践</span></span><span class="level-end"><span class="level-item tag">3</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/%E7%BC%96%E8%AF%91%E5%8E%9F%E7%90%86/"><span class="level-start"><span class="level-item">编译原理</span></span><span class="level-end"><span class="level-item tag">1</span></span></a></li><li><a class="level is-mobile" href="/categories/%E5%AD%A6%E6%A0%A1%E8%AF%BE%E7%A8%8B/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"><span class="level-start"><span class="level-item">项目管理</span></span><span class="level-end"><span class="level-item tag">2</span></span></a></li></ul></li></ul></div></div></div><div class="card widget" data-type="archives"><div class="card-content"><div class="menu"><h3 class="menu-label">归档</h3><ul class="menu-list"><li><a class="level is-mobile" href="/archives/2024/04/"><span class="level-start"><span class="level-item">四月 2024</span></span><span class="level-end"><span class="level-item tag">4</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/03/"><span class="level-start"><span class="level-item">三月 2024</span></span><span class="level-end"><span class="level-item tag">15</span></span></a></li><li><a class="level is-mobile" href="/archives/2024/02/"><span class="level-start"><span class="level-item">二月 2024</span></span><span class="level-end"><span class="level-item tag">63</span></span></a></li></ul></div></div></div><div class="card widget" data-type="tags"><div class="card-content"><div class="menu"><h3 class="menu-label">标签</h3><div class="field is-grouped is-grouped-multiline"><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">#linux</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/anki/"><span class="tag">anki</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/bazel/"><span class="tag">bazel</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/cmake/"><span class="tag">cmake</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/code/"><span class="tag">code</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/dn11/"><span class="tag">dn11</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/docker/"><span class="tag">docker</span><span class="tag">3</span></a></div><div class="control"><a class="tags has-addons" href="/tags/firewall/"><span class="tag">firewall</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/games/"><span class="tag">games</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/hexo/"><span class="tag">hexo</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/icarus/"><span class="tag">icarus</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/istore/"><span class="tag">istore</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/linux/"><span class="tag">linux</span><span class="tag">6</span></a></div><div class="control"><a class="tags has-addons" href="/tags/minio/"><span class="tag">minio</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/openwrt/"><span class="tag">openwrt</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/scoop/"><span class="tag">scoop</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ssh/"><span class="tag">ssh</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/tutorial/"><span class="tag">tutorial</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/ubuntu/"><span class="tag">ubuntu</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/vim/"><span class="tag">vim</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/windows/"><span class="tag">windows</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/wireguard/"><span class="tag">wireguard</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%89%8D%E7%AB%AF/"><span class="tag">前端</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E5%9B%BE%E5%BD%A2%E5%AD%A6/"><span class="tag">图形学</span><span class="tag">4</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E6%9C%8D%E5%8A%A1%E5%99%A8/"><span class="tag">服务器</span><span class="tag">1</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E7%BC%96%E8%AF%91/"><span class="tag">编译</span><span class="tag">2</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%AE%A1%E7%BD%91/"><span class="tag">计网</span><span class="tag">7</span></a></div><div class="control"><a class="tags has-addons" href="/tags/%E8%BD%AF%E8%B7%AF%E7%94%B1/"><span class="tag">软路由</span><span class="tag">2</span></a></div></div></div></div></div></div></div></div></section><footer class="footer"><div class="container"><div class="level"><div class="level-start"><a class="footer-logo is-block mb-2" href="/"><img src="/img/logo.svg" alt="l4rk&#039;s blog" height="28"></a><p class="is-size-7"><span>&copy; 2024 l4rk</span>  Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> &amp; <a href="https://github.com/ppoffice/hexo-theme-icarus" target="_blank" rel="noopener">Icarus</a><br><span id="busuanzi_container_site_uv">共<span id="busuanzi_value_site_uv">0</span>个访客</span></p></div><div class="level-end"></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/moment@2.22.2/min/moment-with-locales.min.js"></script><script src="https://cdn.jsdelivr.net/npm/clipboard@2.0.4/dist/clipboard.min.js" defer></script><script>moment.locale("zh-CN");</script><script>var IcarusThemeSettings = {
            article: {
                highlight: {
                    clipboard: true,
                    fold: 'unfolded'
                }
            }
        };</script><script src="/js/column.js"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
            'HTML-CSS': {
                matchFontHeight: false
            },
            SVG: {
                matchFontHeight: false
            },
            CommonHTML: {
                matchFontHeight: false
            },
            tex2jax: {
                inlineMath: [
                    ['$','$'],
                    ['\\(','\\)']
                ]
            }
        });</script><script src="https://cdn.jsdelivr.net/npm/mathjax@2.7.5/unpacked/MathJax.js?config=TeX-MML-AM_CHTML" defer></script><script src="/js/animation.js"></script><a id="back-to-top" title="回到顶端" href="javascript:;"><i class="fas fa-chevron-up"></i></a><script src="/js/back_to_top.js" defer></script><!--!--><!--!--><!--!--><!--!--><script src="https://cdn.jsdelivr.net/npm/cookieconsent@3.1.1/build/cookieconsent.min.js" defer></script><script>window.addEventListener("load", () => {
      window.cookieconsent.initialise({
        type: "info",
        theme: "edgeless",
        static: false,
        position: "bottom-left",
        content: {
          message: "此网站使用Cookie来改善您的体验。",
          dismiss: "知道了！",
          allow: "允许使用Cookie",
          deny: "拒绝",
          link: "了解更多",
          policy: "Cookie政策",
          href: "https://www.cookiesandyou.com/",
        },
        palette: {
          popup: {
            background: "#edeff5",
            text: "#838391"
          },
          button: {
            background: "#4b81e8"
          },
        },
      });
    });</script><script src="https://cdn.jsdelivr.net/npm/lightgallery@1.6.8/dist/js/lightgallery.min.js" defer></script><script src="https://cdn.jsdelivr.net/npm/justifiedGallery@3.7.0/dist/js/jquery.justifiedGallery.min.js" defer></script><script>window.addEventListener("load", () => {
            if (typeof $.fn.lightGallery === 'function') {
                $('.article').lightGallery({ selector: '.gallery-item' });
            }
            if (typeof $.fn.justifiedGallery === 'function') {
                if ($('.justified-gallery > p > .gallery-item').length) {
                    $('.justified-gallery > p > .gallery-item').unwrap();
                }
                $('.justified-gallery').justifiedGallery();
            }
        });</script><!--!--><!--!--><!--!--><!--!--><!--!--><script src="/js/main.js" defer></script><script src="/live2d-widget/autoload.js"></script><div class="searchbox"><div class="searchbox-container"><div class="searchbox-header"><div class="searchbox-input-container"><input class="searchbox-input" type="text" placeholder="想要查找什么..."></div><a class="searchbox-close" href="javascript:;">×</a></div><div class="searchbox-body"></div></div></div><script src="/js/insight.js" defer></script><script>document.addEventListener('DOMContentLoaded', function () {
            loadInsight({"contentUrl":"/content.json"}, {"hint":"想要查找什么...","untitled":"(无标题)","posts":"文章","pages":"页面","categories":"分类","tags":"标签"});
        });</script></body></html>